name: Convert markdown to html
on: [push]
concurrency:
  group: "pages"
  cancel-in-progress: false
jobs:
    convert_via_pandoc:
        name: Convert markdown to html
        permissions:
          pages: write  
          id-token: write
          actions: read
          contents: read
        environment:
          name: github-pages
          url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        steps:
            - name: Check out pandoc templates
              uses: actions/checkout@v4
              with:
                repository: ryangrose/easy-pandoc-templates
                ref: '80d5aa611ceaee12cd55ac344a1e19cfb7781d14'
                path: easy-pandoc-templates
            - run: |                
                cp easy-pandoc-templates/html/uikit.html ~/uikit.html
            - name: Check out repository
              uses: actions/checkout@v4
            - run: |
                cp ~/uikit.html .
            - name: Convert index markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2
              with:
                args: >- 
                    --standalone
                    --mathjax
                    --to html
                    --output index.html
                    --metadata title="MA32070"
                    --metadata-file metadata.yml
                    index.md
            - run: |
                python3 lectures/parse_crossreferences.py lectures/Notes.md > lectures/_Notes.md
            - name: Convert lecture markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2
              with:
                args: >- 
                    --standalone
                    --toc
                    --mathjax
                    --to html
                    --output notes.html
                    --metadata title="MA32070 Lecture Notes"
                    --resource-path lectures
                    --metadata-file metadata.yml
                    --template uikit.html
                    lectures/_Notes.md
            - name: Convert Exercises markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2               
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output exercises.html
                  --metadata title="MA32070 Exercises"
                  --template uikit.html
                  --resource-path exercises
                  --metadata-file metadata.yml
                  lectures/Exercises.md
            - name: Convert prerequisites markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2              
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output prerequisites.html
                  --metadata title="MA32070 Prerequisites"
                  --template uikit.html
                  --resource-path generalinformation
                  --metadata-file metadata.yml
                  generalinformation/Prerequisites.md
            - name: Convert setup instructions markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output setup.html
                  --metadata title="MA32070 Setup Instructions"
                  --template uikit.html
                  --resource-path generalinformation
                  --metadata-file metadata.yml
                  generalinformation/Setup.md
            - name: Convert model solution exercise 1 markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output model_solution_exercise_python.html
                  --metadata title="MA32070 Exercise 1: Model solution"
                  --template uikit.html
                  --resource-path solutions/exercise_python
                  --metadata-file metadata.yml
                  solutions/exercise_python/Solution.md
            - name: Convert model solution exercise 2 markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output model_solution_exercise_finiteelement.html
                  --metadata title="MA32070 Exercise 2: Model solution"
                  --template uikit.html
                  --resource-path solutions/exercise_finiteelement
                  --metadata-file metadata.yml
                  solutions/exercise_finiteelement/Solution.md
            - name: Convert model solution exercise 3 markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output model_solution_exercise_localassembly.html
                  --metadata title="MA32070 Exercise 3: Model Solution"
                  --template uikit.html
                  --resource-path solutions/exercise_localassembly
                  --metadata-file metadata.yml
                  solutions/exercise_localassembly/Solution.md
            - name: Convert model solution exercise 4 markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output model_solution_exercise_quadrature.html
                  --metadata title="MA32070 Exercise 4: Model Solution"
                  --template uikit.html
                  --resource-path solutions/exercise_quadrature
                  --metadata-file metadata.yml
                  solutions/exercise_quadrature/Solution.md
            - name: Convert model solution exercise 5 markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output model_solution_exercise_global_error.html
                  --metadata title="MA32070 Exercise 5: Model Solution"
                  --template uikit.html
                  --resource-path solutions/exercise_global_error
                  --metadata-file metadata.yml
                  solutions/exercise_global_error/Solution.md
            - name: Convert model solution exercise 6 markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output model_solution_exercise_complexity.html
                  --metadata title="MA32070 Exercise 6: Model Solution"
                  --template uikit.html
                  --resource-path solutions/exercise_complexity
                  --metadata-file metadata.yml
                  solutions/exercise_complexity/Solution.md
            - name: Convert model solution exercise 7 markdown to html with pandoc
              uses: docker://pandoc/latex:3.7.0.2                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --toc
                  --to html
                  --output model_solution_exercise_petsc.html
                  --metadata title="MA32070 Exercise 7: Model Solution"
                  --template uikit.html
                  --resource-path solutions/exercise_petsc
                  --metadata-file metadata.yml
                  solutions/exercise_petsc/Solution.md
            - name: Copy to deployment folder
              run: |
                    mkdir docs
                    mv index.html docs
                    mv setup.html docs
                    mv prerequisites.html docs
                    mv notes.html docs
                    mv exercises.html docs
                    cp -r lectures/figures docs
                    # EXERCISE 1
                    DIR=model_solution_exercise_python
                    mkdir docs/${DIR}
                    mv ${DIR}.html docs/${DIR}/solution.html
                    cp solutions/exercise_python/numerical_integration.py docs/${DIR}
                    cp solutions/exercise_python/driver.py docs/${DIR}
                    cp solutions/exercise_python/linear_algebra_numpy.py docs/${DIR}                    
                    cp solutions/exercise_python/linear_algebra_petsc.py docs/${DIR}
                    # EXERCISE 2
                    DIR=model_solution_exercise_finiteelement
                    mkdir docs/${DIR}
                    mv ${DIR}.html docs/${DIR}/solution.html
                    cp solutions/exercise_finiteelement/cubicelement.py docs/${DIR}
                    cp solutions/exercise_finiteelement/test_cubicelement.py docs/${DIR}
                    cp solutions/exercise_finiteelement/cubic_element.png docs/${DIR}
                    # EXERCISE 3
                    DIR=model_solution_exercise_localassembly
                    mkdir docs/${DIR}
                    mv ${DIR}.html docs/${DIR}/solution.html
                    cp solutions/exercise_localassembly/algorithms.py docs/${DIR}
                    cp solutions/exercise_localassembly/driver.py docs/${DIR}
                    cp solutions/exercise_localassembly/triangle_solution_??.png docs/${DIR}
                    # EXERCISE 4
                    DIR=model_solution_exercise_quadrature
                    mkdir docs/${DIR}
                    mv ${DIR}.html docs/${DIR}/solution.html
                    cp solutions/exercise_quadrature/threepointquadrature.py docs/${DIR}
                    cp solutions/exercise_quadrature/test_threepointquadrature.py docs/${DIR}
                    # EXERCISE 5
                    DIR=model_solution_exercise_global_error
                    mkdir docs/${DIR}
                    mv ${DIR}.html docs/${DIR}/solution.html
                    cp solutions/exercise_global_error/algorithms.py docs/${DIR}
                    cp solutions/exercise_global_error/driver.py docs/${DIR}
                    cp solutions/exercise_global_error/convergence.png docs/${DIR}
                    # EXERCISE 6
                    DIR=model_solution_exercise_complexity
                    mkdir docs/${DIR}
                    mv ${DIR}.html docs/${DIR}/solution.html
                    # EXERCISE 7
                    DIR=model_solution_exercise_petsc
                    mkdir docs/${DIR}
                    mv ${DIR}.html docs/${DIR}/solution.html
                    cp solutions/exercise_petsc/*.svg docs/${DIR}                    
                    cp solutions/exercise_petsc/linear_solve.py docs/${DIR}
            - name: Upload artifacts
              uses: actions/upload-pages-artifact@v3
              with:
                path: './docs/'
                name: github-pages
            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
