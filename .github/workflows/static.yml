name: Convert markdown to html
on: [push]
concurrency:
  group: "pages"
  cancel-in-progress: false
jobs:
    convert_via_pandoc:
        name: Convert markdown to html
        permissions:
          pages: write  
          id-token: write
          actions: read
          contents: read
        environment:
          name: github-pages
          url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        steps:
            - name: Check out pandoc templates
              uses: actions/checkout@v4
              with:
                repository: ryangrose/easy-pandoc-templates
                ref: '80d5aa611ceaee12cd55ac344a1e19cfb7781d14'
                path: easy-pandoc-templates
            - name: Copy pandoc templates
              run: |
                mkdir -p ~/.pandoc/templates
                cp easy-pandoc-templates/html/*.html ~/.pandoc/templates
            - name: Check out repository
              uses: actions/checkout@v4
            - name: Convert lecture markdown to html with pandoc
              uses: docker://pandoc/latex:3.5                
              with:
                args: >- 
                    --standalone
                    --toc
                    --mathjax
                    --to html
                    --output=notes.html
                    --resource-path lectures
                    --metadata-file metadata.yml
                    --template=uikit.html
                    lectures/notes.md
            - name: Convert setup instructions markdown to html with pandoc
              uses: docker://pandoc/latex:3.5                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --to html
                  --output=setup.html
                  --template=uikit.html
                  --resource-path generalinformation
                  --metadata-file metadata.yml
                  generalinformation/Setup.md
            - name: Unzip deployment folder
              run: |
                    mkdir docs
                    mkdir docs/lectures
                    mkdir docs/general
                    mv setup.html docs/general
                    mv notes.html docs/lectures
                    cd docs/lectures
            - name: Upload artifacts
              uses: actions/upload-pages-artifact@v3
              with:
                path: './docs/'
                name: github-pages
            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
