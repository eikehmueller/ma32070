name: Convert markdown to html
on: [push]
concurrency:
  group: "pages"
  cancel-in-progress: false
jobs:
    convert_via_pandoc:
        env:
          Greeting: lectures_directory
        name: Convert markdown to html
        permissions:
            contents: write           
        runs-on: ubuntu-latest
        steps:
            - name: Check out repository
              uses: actions/checkout@v4
            - name: Convert markdown to html with pandoc
              uses: docker://pandoc/latex:3.5                
              with:
                args: >- 
                    --standalone
                    --mathjax
                    --to chunkedhtml
                    --output=docs.zip
                    --resource-path $lectures_directory
                    $lectures_directory/MathematicalBackground.md
                    $lectures_directory/FiniteElements.md
                    $lectures_directory/Quadrature.md
                    $lectures_directory/ErrorAnalysis.md
                    $lectures_directory/Meshes.md
            - name: Unzip deployment folder
              run: |
                    unzip docs.zip
            - name: Deploy html file to gh-pages branch
              uses: JamesIves/github-pages-deploy-action@3.6.2
              with:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                BRANCH: gh-pages
                CLEAN: true
                SINGLE_COMMIT: true
                FOLDER: docs
                GIT_CONFIG_NAME: eikehmueller
                GIT_CONFIG_EMAIL: e.mueller@bath.ac.uk
    deploy:
        name: Deploy to GitHub Pages
        needs: convert_via_pandoc
        permissions:
            pages: write  
            id-token: write
            actions: read
            contents: read
        runs-on: ubuntu-latest
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        steps:
            - name: Check out repository
              uses: actions/checkout@v4
              with:
                ref: 'gh-pages'
            - name: Upload artifacts
              uses: actions/upload-pages-artifact@v3
              with:
                path: '.'
                name: github-pages
            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
