name: Convert markdown to html
on: [push]
concurrency:
  group: "pages"
  cancel-in-progress: false
jobs:
    convert_via_pandoc:
        permissions:
            contents: write           
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-22.04
        steps:
            - name: Setup Pages
              uses: actions/configure-pages@v5
            - name: Check out repository
              uses: actions/checkout@v4
            - name: Convert with pandoc
              uses: docker://pandoc/latex:3.5                
              with:
                args: >-  # allows you to break string into multiple lines
                    --standalone
                    --mathjax
                    --output=lectures/MathematicalBackground.html
                    lectures/MathematicalBackground.md
            - name: Copy 
              run: |
                    mkdir docs
                    cp ./lectures/MathematicalBackground.html ./docs/MathematicalBackground.html      
            - name: Create index.html
              run: echo "<h>Index</h>" > ./docs/index.html
            - name: Deploy html file
              uses: JamesIves/github-pages-deploy-action@3.6.2
              with:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                BRANCH: gh-pages
                CLEAN: true
                SINGLE_COMMIT: true
                FOLDER: docs
                GIT_CONFIG_NAME: eikehmueller
                GIT_CONFIG_EMAIL: e.mueller@bath.ac.uk
    deploy:
        needs: convert_via_pandoc
        permissions:
            pages: write  
            id-token: write
            actions: read
            contents: read
        runs-on: ubuntu-latest
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        steps:
            - name: Check out repository
              uses: actions/checkout@v4
              with:
                ref: 'gh-pages'
            - name: Upload artifacts
              uses: actions/upload-pages-artifact@v3
              with:
                path: '.'
                name: github-pages
            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
