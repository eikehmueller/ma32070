name: Convert markdown to html
on: [push]
concurrency:
  group: "pages"
  cancel-in-progress: false
jobs:
    convert_via_pandoc:
        name: Convert markdown to html
        permissions:
          pages: write  
          id-token: write
          actions: read
          contents: read
        environment:
          name: github-pages
          url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        steps:
            - name: Check out repository
              uses: actions/checkout@v4
            - name: Convert lecture markdown to html with pandoc
              uses: docker://pandoc/latex:3.5                
              with:
                args: >- 
                    --standalone
                    --mathjax
                    --to chunkedhtml
                    --output=notes.zip
                    --resource-path lectures
                    --metadata-file metadata.yml
                    lectures/Prerequisites.md
                    lectures/MathematicalBackground.md
                    lectures/FiniteElements.md
                    lectures/Quadrature.md
                    lectures/ErrorAnalysis.md
                    lectures/Meshes.md
                    lectures/FunctionSpaces.md
                    lectures/GlobalAssembly.md
                    lectures/SparseMatrices.md
                    lectures/SolversAndPreconditioners.md
                    lectures/SparseAssembly.md
            - name: Convert setup instructions markdown to html with pandoc
              uses: docker://pandoc/latex:3.5                
              with:
                args: >- 
                  --standalone
                  --mathjax
                  --to html
                  --output=setup.html
                  --resource-path generalinformation
                  --metadata-file metadata.yml
                  generalinformation/Setup.md
            - name: Unzip deployment folder
              run: |
                    mkdir docs
                    mkdir docs/lectures
                    mkdir docs/general
                    mv setup.html docs/general
                    mv notes.zip docs/lectures
                    cd docs/lectures
                    unzip notes.zip
            - name: Upload artifacts
              uses: actions/upload-pages-artifact@v3
              with:
                path: './docs/'
                name: github-pages
            - name: Deploy to GitHub Pages
              id: deployment
              uses: actions/deploy-pages@v4
